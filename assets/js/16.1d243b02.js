(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{273:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ç”¨rustæ‰©å±•emacsåŠŸèƒ½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨rustæ‰©å±•emacsåŠŸèƒ½"}},[s._v("#")]),s._v(" ç”¨ Rust æ‰©å±• Emacs åŠŸèƒ½")]),s._v(" "),a("h2",{attrs:{id:"æ‘˜è¦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ‘˜è¦"}},[s._v("#")]),s._v(" æ‘˜è¦")]),s._v(" "),a("p",[s._v("åœ¨ Emacs 25 ä¸­ï¼ŒEmacs å¼•å…¥äº†ã€åŠ¨æ€æ¨¡å—ã€ï¼ˆdynamic moduleï¼‰çš„æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨ C\n è¯­è¨€è§„å®šçš„åŠ¨æ€é“¾æ¥åº“æ ¼å¼æ‰©å±• Emacs æœ¬èº«æ‰€ç¼ºä¹çš„èƒ½åŠ›ã€‚")]),s._v(" "),a("p",[s._v("æœ¬æ–‡é˜é‡Šäº†ä½¿ç”¨ Rust å¼€å‘åŠ¨æ€æ¨¡å—ç›¸å¯¹äº C è¯­è¨€çš„ä¼˜åŠ¿ï¼Œå¹¶ä»‹ç»è®²è§£å¦‚ä½•ä½¿ç”¨\n"),a("a",{attrs:{href:"https://github.com/ubolonton/emacs-module-rs",target:"_blank",rel:"noopener noreferrer"}},[s._v(" ubolonto"),a("OutboundLink")],1),s._v(" å¼€å‘çš„\n"),a("a",{attrs:{href:"https://github.com/ubolonton/emacs-module-rs",target:"_blank",rel:"noopener noreferrer"}},[s._v(" emacs-module-rs"),a("OutboundLink")],1),s._v(" ç®€åŒ– Rust åŠ¨æ€æ¨¡ç»„å¼€å‘\næµç¨‹ã€‚")]),s._v(" "),a("h2",{attrs:{id:"ä¸ºä»€ä¹ˆé€‰æ‹©rustè€Œä¸æ˜¯c"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆé€‰æ‹©rustè€Œä¸æ˜¯c"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆé€‰æ‹© Rust è€Œä¸æ˜¯ C")]),s._v(" "),a("p",[s._v("C è¯­è¨€ä½œä¸ºä¸€é—¨ä¸Šä¸–çºª 70 å¹´ä»£å‘æ˜çš„ç¼–ç¨‹è¯­è¨€ï¼Œå…¶å†å²å±€é™æ€§ååˆ†ä¸¥é‡ã€‚å¯ä»¥è®¤ä¸ºï¼ŒC è¯­è¨€çš„\nä¸€äº›ç¼ºé™·ï¼Œé˜»ç¢äº†åŠ¨æ€æ¨¡å—è¿™ä¸€æ‰©å±•æ–¹å¼çš„æµè¡Œã€‚")]),s._v(" "),a("ul",[a("li",[s._v("è¯­è¨€æœ¬èº«è¿‡äºåº•å±‚ï¼Œç¼ºä¹è¡¨è¾¾èƒ½åŠ›ï¼Œéœ€è¦æµªè´¹ç²¾åŠ›åœ¨å†…å­˜ç®¡ç†ä¸Šã€‚å¯¹èšç„¦äºä»£ç é€»è¾‘æœ¬èº«\nçš„å¿«é€Ÿå¼€å‘ä¸å¤Ÿæ–¹ä¾¿ã€‚")]),s._v(" "),a("li",[s._v("ç¼ºä¹è‰¯å¥½çš„ç±»å‹çº¦æŸï¼Œå®¹æ˜“å†™å‡ºå†…å­˜ä¸å®‰å…¨çš„ä»£ç ã€‚")]),s._v(" "),a("li",[s._v("ç¼ºå°‘ä¸­å¿ƒåŒ–çš„åŒ…åˆ†å‘ç®¡ç†ç³»ç»Ÿï¼Œè·å–æ„å»ºä¾èµ–ååˆ†éº»çƒ¦ã€‚")]),s._v(" "),a("li",[s._v("ä¸åŒç”¨æˆ·ä¸Šçš„ C è¯­è¨€ç¼–è¯‘å™¨å’Œ C è¯­è¨€è¿è¡Œæ—¶ä¸åŒï¼Œåœ¨ç”¨æˆ·æ„å»ºä½¿ç”¨æ—¶å®¹æ˜“å‡ºç°éš¾ä»¥å¤ç°çš„\n BUG")])]),s._v(" "),a("p",[s._v("Rust ä½œä¸ºä¸€é—¨æ–°æ—¶ä»£çš„ï¼Œèšç„¦äºå†…å­˜å®‰å…¨ï¼Œåº•å±‚æ•ˆç‡ä»¥åŠå¹¶å‘çš„è¯­è¨€ï¼Œæ­£å¥½å®Œç¾è§£å†³äº† C è¯­\nè¨€å¸¦æ¥çš„è¿™äº›ç—›ç‚¹ã€‚")]),s._v(" "),a("ul",[a("li",[s._v("Rust æœ¬èº«æ”¯æŒæœ€å¸¸ç”¨çš„ä¸‰å¤§æ“ä½œç³»ç»Ÿï¼Œä»£ç å’Œæ„å»ºç³»ç»Ÿæ— é¡»åšè¿‡å¤šè°ƒæ•´å³å¯è·¨å¹³å°ä½¿ç”¨ã€‚")]),s._v(" "),a("li",[s._v("Rust ä¸ C ä¹‹é—´æœ‰è‰¯å¥½çš„äº’æ“ä½œæ€§ï¼Œå³ä½¿éœ€è¦è°ƒç”¨ C è¯­è¨€è½®å­ä¹Ÿä¸ä¼šè¿‡äºç¹çã€‚")]),s._v(" "),a("li",[s._v("Rust ä½¿å¾—å¼€å‘è€…åœ¨ç¼–å†™åŠ¨æ€æ¨¡ç»„æ—¶æ— éœ€åƒ C è¯­è¨€ä¸€æ ·ä¸ºäº†å¤„ç†å†…å­˜ç»†èŠ‚è€Œçƒ¦æ¼ã€‚å¯\nä»¥é›†ä¸­ç²¾ç¥åœ¨ä»£ç é€»è¾‘ä¸Šã€‚")]),s._v(" "),a("li",[s._v("Emacs module çš„ Rust ç»‘å®šå…·æœ‰è‰¯å¥½çš„æŠ½è±¡å°è£…ï¼Œé¿å…äº†ç›´æ¥ä¸ "),a("code",[s._v("emacs_module.h")]),s._v("  é‡Œå®šä¹‰çš„\nåº•å±‚å‡½æ•°äº¤äº’çš„ç¹çç»†èŠ‚ã€‚")]),s._v(" "),a("li",[s._v("Rust å…·æœ‰ä¼˜ç§€çš„ç¤¾åŒºç”Ÿæ€ï¼Œå¯ä»¥å¤ç”¨å¤§é‡å¼€æºç¤¾åŒºçš„è½®å­ï¼ŒèŠ‚çº¦äº†å¼€å‘æ—¶é—´ã€‚")])]),s._v(" "),a("h2",{attrs:{id:"ç›®æ ‡è¯»è€…ç¾¤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç›®æ ‡è¯»è€…ç¾¤"}},[s._v("#")]),s._v(" ç›®æ ‡è¯»è€…ç¾¤")]),s._v(" "),a("p",[s._v("æœ¬æ–‡å‡å®šä½ æœ‰ä¸€å®šçš„ Rust å’Œ Elisp ç¼–ç¨‹ç»éªŒã€‚å¦‚æœä½ æ²¡æœ‰ï¼Œå¯ä»¥å…ˆä»è¿™é‡Œå¼€å§‹")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/rust-lang-cn/rust-by-example-cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("Rust by Exampleï¼ˆä¸­æ–‡ï¼‰"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.gnu.org/software/emacs/manual/eintr.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("An Introduction to Programming in Emacs Lispï¼ˆè‹±\næ–‡ï¼‰"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"ç¯å¢ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒ"}},[s._v("#")]),s._v(" ç¯å¢ƒ")]),s._v(" "),a("p",[s._v("æœ¬èŠ‚è®°å½•å†™ä¸‹æœ¬æ–‡æ‰€ç”¨çš„æ“ä½œç³»ç»Ÿä»¥åŠç›¸å…³è½¯ä»¶çš„ç‰ˆæœ¬")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Archlinux")])]),s._v(" "),a("li",[a("code",[s._v("Emacs 26.3")])]),s._v(" "),a("li",[a("code",[s._v("rustc 1.41.1 (f3e1a954d 2020-02-24)")])]),s._v(" "),a("li",[a("code",[s._v("clang 9.0.1")])]),s._v(" "),a("li",[a("code",[s._v("llvm 9.0.1")])])]),s._v(" "),a("h2",{attrs:{id:"åˆè¯•ç‰›åˆ€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆè¯•ç‰›åˆ€"}},[s._v("#")]),s._v(" åˆè¯•ç‰›åˆ€")]),s._v(" "),a("h3",{attrs:{id:"åˆ›å»ºé¡¹ç›®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºé¡¹ç›®"}},[s._v("#")]),s._v(" åˆ›å»ºé¡¹ç›®")]),s._v(" "),a("p",[s._v("æ‰§è¡Œä¸‹åˆ—å‘½ä»¤åˆ›å»ºä¸€ä¸ªç©ºç™½ Rust é¡¹ç›®")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("cargo init --lib greeting\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" greeting\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ä¿®æ”¹  "),a("code",[s._v("Cargo.toml")]),s._v("  æ–‡ä»¶")]),s._v(" "),a("div",{staticClass:"language-toml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"greeting"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.1.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("edition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2018"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æˆ‘ä»¬é€šå¸¸å¸Œæœ›æŠŠ Emacs ç›¸å…³çš„ package å‘å¸ƒåœ¨ ELPA è€Œä¸æ˜¯ crates.io ä¸Š")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("publish")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("lib")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡è¦ï¼Œå¦åˆ™ Rust ä¸ä¼šç”Ÿæˆå…¼å®¹ C ABI çš„åŠ¨æ€åº“")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("crate-type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cdylib"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡è¦ï¼Œåˆ›å»º Emacs åŠ¨æ€æ¨¡å—çš„å…³é”®ä¾èµ–")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("emacs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.13"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"ç¼–ç "}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–ç "}},[s._v("#")]),s._v(" ç¼–ç ")]),s._v(" "),a("p",[a("code",[s._v("src/lib.rs")])]),s._v(" "),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("emacs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("defun"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šä¹‰ä¸€ä¸ª C int ç±»å‹çš„åä¸º plugin_is_GPL_compatible çš„å…¨å±€å˜é‡ï¼Œå¦åˆ™ Emacs ä¼šæ‹’ç»åŠ ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è½½æ¨¡å— :)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("emacs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")])]),a("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("plugin_is_GPL_compatible!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®šä¹‰æ¨¡å—å…¥å£ï¼Œå¤§éƒ¨ä»½æƒ…å†µæˆ‘ä»¬ä¸éœ€è¦å®ƒåšä»»ä½•äº‹ã€‚")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[emacs::module]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ok")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// è¾“å‡ºä¸€æ¡ä½ å¥½ä¿¡æ¯")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[defun]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("say_hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Value")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token lifetime-annotation symbol"}},[s._v("'_")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("format!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello, {}!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"ç¼–è¯‘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–è¯‘"}},[s._v("#")]),s._v(" ç¼–è¯‘")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("cargo build\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯¹äºåä¸º libxxx çš„åŠ¨æ€åº“æ–‡ä»¶ï¼Œé¡»æ›´åä¸º crate çš„å‘½åï¼Œä»¥ä¿è¯ emacs-module-rs ç”Ÿ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æˆçš„ provide form æä¾›çš„ feature ä¸æ–‡ä»¶åç›¸åŒ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Linux ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sv target/debug/libgreeting.so greeting.so\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Mac")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sv target/debug/libgreeting.dylib greeting.so\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Windows")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Windows10 é»˜è®¤ç¦æ­¢ä¸€èˆ¬ç”¨æˆ·åˆ›å»ºè½¯é“¾æ¥ï¼Œä½ å¯ä»¥å‚ç…§")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/create-symbolic-links ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸ºä½ è‡ªå·±å¯ç”¨è½¯é“¾æ¥åˆ›é€ æƒé™ï¼Œè¿™é‡Œä½¿ç”¨ç¡¬é“¾æ¥ä½œä¸ºæ›¿ä»£ã€‚")]),s._v("\nmklink target/debug/greeting.dll greeting.dll\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"åŠ è½½è¿è¡Œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŠ è½½è¿è¡Œ"}},[s._v("#")]),s._v(" åŠ è½½è¿è¡Œ")]),s._v(" "),a("div",{staticClass:"language-lisp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-lisp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("add-to-list")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token quoted-symbol variable symbol"}},[s._v("'load-path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<path/to/your/project/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token quoted-symbol variable symbol"}},[s._v("'greeting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("greeting-say-hello")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Emacs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è‹¥ä¸€åˆ‡é¡ºåˆ©ï¼Œminibuffer ä¼šå¼¹å‡ºä¿¡æ¯  "),a("code",[s._v("Hello, Emacs!")])]),s._v(" "),a("h2",{attrs:{id:"emacs-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#emacs-value"}},[s._v("#")]),s._v(" "),a("code",[s._v("emacs::Value")])]),s._v(" "),a("p",[a("code",[s._v("emacs::Value")]),s._v("  æ˜¯åœ¨ Rust è¡¨ç¤º Elisp å€¼çš„ä»£ç†ç±»å‹ï¼Œæ¯ä¸ª  "),a("code",[s._v("Value")]),s._v("  ä»£è¡¨ä¸€ä¸ªå¯¹ Elisp\n å€¼çš„å¼•ç”¨ã€‚ç”±äºå…·ä½“çš„å†…å­˜åˆ†é…å®é™…ä¸Šæ˜¯ Elisp VM çš„ GC åœ¨ç®¡ç†ï¼Œ "),a("code",[s._v("Value")]),s._v("  åœ¨ Rust é‡Œçš„æ‹·è´å’Œ\nç§»åŠ¨æ˜¯ååˆ†è½»é‡çš„ï¼ˆå› æ­¤å®ç°äº†  "),a("code",[s._v("Copy")]),s._v("  traitï¼‰ã€‚")]),s._v(" "),a("p",[s._v("Rust æ— æ³•ç›´æ¥åˆ©ç”¨ä¸€ä¸ª  "),a("code",[s._v("Value")]),s._v(" ï¼Œåªæœ‰  "),a("code",[s._v("emacs-module.h")]),s._v("  æä¾›äº†è½¬æ¢å‡½æ•°çš„çš„åŸºæœ¬ç±»å‹å¯\nä»¥ç”¨äºè½¬æ¢ã€‚åœ¨åº•å±‚å‡½æ•°ä¹‹ä¸Šï¼Œ "),a("code",[s._v("emacs-module-rs")]),s._v("  åˆæä¾›äº†  "),a("code",[s._v("IntoLisp")]),s._v("  å’Œ "),a("code",[s._v("FromLisp")]),s._v(" \ntrait ç”¨äºæŠ½è±¡ Rust ç±»å‹åˆ°  "),a("code",[s._v("Value")]),s._v("  ä¹‹é—´çš„è½¬æ¢ã€‚")]),s._v(" "),a("p",[s._v("ä¸‹åˆ—ç±»å‹å®ç°äº†è¿™äº› traitsã€‚ä½ ä¹Ÿå¯ä»¥ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç°è¿™äº› traits æ¥å®ç°å¤æ‚æ•°æ®çš„è½¬æ¢ã€‚")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Value")]),s._v("  å¯¹åº”è‡ªå·± ğŸ˜›")]),s._v(" "),a("li",[a("code",[s._v("i64")]),s._v("  å¯¹åº”ä¸€ä¸ª Elisp fixnumï¼ˆ64 ä½æœ‰ç¬¦å·æ•´å‹")]),s._v(" "),a("li",[a("code",[s._v("f64")]),s._v("  å¯¹åº”ä¸€ä¸ª Elisp floatï¼ˆ64 ä½åŒç²¾åº¦æµ®ç‚¹ï¼‰")]),s._v(" "),a("li",[a("code",[s._v("String")]),s._v("  å¯¹åº”ä¸€ä¸ª Elisp å­—ç¬¦ä¸²ï¼ˆä¸å« text propertyï¼‰")]),s._v(" "),a("li",[a("code",[s._v("emacs::Vector")]),s._v("  å¯¹åº”ä¸€ä¸ª Elisp å‘é‡")]),s._v(" "),a("li",[a("code",[s._v("()")]),s._v("  å¯¹åº” Elisp çš„  "),a("code",[s._v("nil")])]),s._v(" "),a("li",[a("code",[s._v("Option<T>")]),s._v("  å¯¹åº”ä¸€ä¸ªå¯ä¸º  "),a("code",[s._v("nil")]),s._v("  çš„ Elisp å€¼ï¼Œå…·ä½“ç±»å‹ç”±  "),a("code",[s._v("T")]),s._v("  å†³å®š")])]),s._v(" "),a("h2",{attrs:{id:"defun"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#defun"}},[s._v("#")]),s._v(" "),a("code",[s._v("#[defun]")])]),s._v(" "),a("p",[a("code",[s._v("emacs::defun")]),s._v("  æ˜¯  "),a("code",[s._v("emacs-module-rs")]),s._v("  æœ€ä¸»è¦çš„é­”æ³•ï¼Œè¿™ä¸ªå±æ€§å®ä¿®é¥°ä¸€ä¸ª Rust çš„å‡½æ•°\nå®šä¹‰ï¼Œä½¿å…¶è½¬å˜ä¸ºå¯ä»¥åœ¨ Elisp VM é‡Œè°ƒç”¨çš„æ¨¡å—å‡½æ•°ã€‚")]),s._v(" "),a("p",[s._v("è¢«ä¿®é¥°çš„å‡½æ•°å¯ä»¥æ¥æ”¶ä»»æ„æ•°é‡çš„æ‰€æœ‰æƒç±»å‹ï¼Œä¸”ç±»å‹å®ç°äº† "),a("code",[s._v("FromLisp")]),s._v("  trait çš„å‚æ•°ï¼Œæœ€ç»ˆè¿”å›\n "),a("code",[s._v("emacs::Result<T>")]),s._v("  å…¶ä¸­  "),a("code",[s._v("T")]),s._v("  å®ç° "),a("code",[s._v("IntoLisp")]),s._v("  traitã€‚ç®€åŒ–äº†è¿”å›å’Œå–ç”¨ Elisp å€¼æ—¶æ‰‹åŠ¨è½¬å‹çš„\næ¨¡æ¿ä»£ç ã€‚")]),s._v(" "),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ä¸€ä¸ªæ„šè ¢ä½†æ˜¯ç®€å•çš„ä¾‹å­ï¼Œè¿™ä¸ªæ³¨é‡Šä¼šè¢«å¯¼å…¥ Emacs çš„å¸®åŠ©ç³»ç»Ÿä¸­ï¼Œ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// é€šè¿‡ M-x describe-function æŸ¥é˜…ã€‚")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[defun]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lhs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("i64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rhs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("i64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("emacs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("i64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ok")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lhs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" rhs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"å‘½åä¿®é¥°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‘½åä¿®é¥°"}},[s._v("#")]),s._v(" å‘½åä¿®é¥°")]),s._v(" "),a("p",[s._v("Elisp ç¼ºä¹å‘½åç©ºé—´ç³»ç»Ÿï¼Œæ¯ä¸ªåŒ…éƒ½æ‹¥æœ‰è‡ªå·±çš„å‘½åå‰ç¼€æ¥é˜²æ­¢äº§ç”Ÿå‘½åå†²çªã€‚\n "),a("code",[s._v("emacs-module-rs")]),s._v("  å¯¼å‡ºçš„ Elisp å‡½æ•°çš„å‘½åä¿®é¥°æ ¼å¼ä¸º  "),a("code",[s._v("<åŒ…å>[ç›¸å¯¹äºcrateçš„Rustæ¨¡å—è·¯ å¾„å]<å‡½æ•°å>")])]),s._v(" "),a("p",[s._v("Rust çš„ snake_case é£æ ¼å‘½åä¼šè¢«è½¬æ¢æˆ kebab-case çš„ Lisp é£æ ¼å‘½åï¼Œè¡¨ç¤ºè·¯å¾„çš„\n "),a("code",[s._v("::")]),s._v("  ä¹Ÿä¼šè¢«è½¬æ¢ä¸º Lisp é£æ ¼çš„  "),a("code",[s._v("-")])]),s._v(" "),a("h2",{attrs:{id:"è°ƒç”¨elispå‡½æ•°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è°ƒç”¨elispå‡½æ•°"}},[s._v("#")]),s._v(" è°ƒç”¨ Elisp å‡½æ•°")]),s._v(" "),a("h3",{attrs:{id:"è°ƒç”¨å…¨å±€é™æ€å‡½æ•°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è°ƒç”¨å…¨å±€é™æ€å‡½æ•°"}},[s._v("#")]),s._v(" è°ƒç”¨å…¨å±€é™æ€å‡½æ•°")]),s._v(" "),a("p",[a("code",[s._v("emacs::Env")]),s._v("  ç±»å‹ä¸Šé™æ€æŒ‚è½½äº†å¸¸ç”¨çš„ Elisp å‡½æ•°ï¼Œè¿™äº›å‡½æ•°é€šå¸¸éƒ½æ˜¯  "),a("code",[s._v("emacs-module.h")]),s._v(" \n ç›´æ¥æš´éœ²å‡ºæ¥çš„ã€‚")]),s._v(" "),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"defun"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("type_of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("into_lisp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("provide")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-module"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("è¦æ•æ‰ä¸€ä¸ª  "),a("code",[s._v("Env")]),s._v("  æ¥è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œè¯·åœ¨  "),a("code",[s._v("defun")]),s._v("  ä¿®é¥°çš„å‡½æ•°å®šä¹‰é‡Œé¢å¤–åŠ å…¥ä¸€ä¸ªç±»å‹ä¸º\n "),a("code",[s._v("&Env")]),s._v("  çš„å‚æ•°ã€‚")]),s._v(" "),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// æ˜¯çš„ï¼Œè¿™å‡½æ•°å°†ä¸€ä¸ªå­—ç¬¦ä¸² intern ä¸º Elisp symbolã€‚ä½†æ˜¯ä½ ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨ Elisp é‡Œ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ç”¨ intern å‘¢")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[defun]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("silly_intern")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token lifetime-annotation symbol"}},[s._v("'e")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token lifetime-annotation symbol"}},[s._v("'e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("emacs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Value")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token lifetime-annotation symbol"}},[s._v("'e")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("as_ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"è°ƒç”¨ä»»æ„å‡½æ•°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è°ƒç”¨ä»»æ„å‡½æ•°"}},[s._v("#")]),s._v(" è°ƒç”¨ä»»æ„å‡½æ•°")]),s._v(" "),a("p",[a("code",[s._v("emacs::Env::call(func, args)")]),s._v("  å¯ä»¥è°ƒç”¨ä»»æ„ Elisp å‡½æ•°ï¼Œå…¶ä¸­")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("func")]),s._v("  å¯ä¸ºæ ‡è¯†å‡½æ•°åçš„å­—ç¬¦ä¸²ï¼ˆè°ƒç”¨å¯¹åº”çš„  "),a("code",[s._v("symbol-function")]),s._v(" ï¼‰ï¼Œæˆ–è€…å¯è°ƒç”¨çš„\n "),a("code",[s._v("Value")]),s._v("  ï¼ˆå¦‚é—­åŒ…ï¼‰")]),s._v(" "),a("li",[a("code",[s._v("args")]),s._v("  å¯ä¸ºä¸€ä¸ª  "),a("code",[s._v("&[Value]")]),s._v("  ç±»å‹ï¼Œæˆ–è€…ä¸€ä¸ªåŒ…å«äº† 1-12ï¼ˆå—é™äºå®ç°ï¼Œæš‚æ—¶ä¸Šé™ 12 ä¸ªï¼‰\nä¸ªå…ƒç´ ï¼Œä¸”æ¯ä¸ªå…ƒç´ éƒ½å®ç°äº†  "),a("code",[s._v("IntoLisp")]),s._v("  trait çš„å…ƒç»„")])]),s._v(" "),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// (list "str" 2)')]),s._v("\nenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (symbol-function 'list)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" subr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"symbol-function"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// (funcall \'list "str" 2)')]),s._v("\nenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// (funcall (symbol-function \'list) "str" 2)')]),s._v("\nenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsubr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç®€å†™")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (add-hook 'text-mode-hook 'variable-pitch-mode)")]),s._v("\nenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add-hook"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text-mode-hook"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"variable-pitch-mode"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// å°†ä¸€ä¸ª Elisp Vector è½¬æ¢ä¸º Elisp List")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[defun]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("listify_vec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Value")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mut")]),s._v(" args "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("vec!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("vector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    vector"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),s._v(" "),a("h2",{attrs:{id:"å‘elisp-vmåµŒå…¥rustå¤åˆæ•°æ®ç±»å‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‘elisp-vmåµŒå…¥rustå¤åˆæ•°æ®ç±»å‹"}},[s._v("#")]),s._v(" å‘ Elisp VM åµŒå…¥ Rust å¤åˆæ•°æ®ç±»å‹")]),s._v(" "),a("p",[s._v("å°†ä¸€ä¸ª Rust çš„å¤åˆæ•°æ®ç±»å‹å®Œæ•´è½¬æ¢ä¸º Elisp é‡Œçš„æ•°æ®ç±»å‹å¾€å¾€å¾ˆå›°éš¾ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨ Rust\n çº¿ç¨‹å’Œ Elisp VM é—´åå¤è¿›è¡Œæ•°æ®è½¬æ¢ä¼šé™ä½æ¨¡å—æ‰§è¡Œçš„æ•ˆç‡ã€‚å› æ­¤ï¼ŒElisp æä¾› "),a("code",[s._v("user-ptr")]),s._v(" \n ç±»å‹ç”¨äºæ‰¿è½½å¯¹ Elisp ä¸é€æ˜çš„å¤–éƒ¨ç±»å‹å®ä¾‹ã€‚")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("æç¤º")]),s._v(" "),a("p",[s._v("ä¸ºäº†ä½¿å¯¼å‡ºçš„è‡ªå®šä¹‰ç±»å‹æœ‰æ„ä¹‰ï¼Œä½ è¿˜éœ€è¦é¢å¤–ç¼–å†™æ“ä½œè¯¥æ•°æ®ç±»å‹çš„æ¨¡å—å‡½æ•°ã€‚")])]),s._v(" "),a("p",[a("code",[s._v("user-ptr")]),s._v("  ç±»å‹çš„é‡Šæ”¾ç”± Elisp VM çš„ GC æ‰˜ç®¡ï¼Œæ¯”èµ·ä¸€èˆ¬ Rust å¤åˆæ•°æ®ç±»å‹æœ‰é¢å¤–çº¦æŸï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("user-ptr")]),s._v("  ç±»å‹å®ä¾‹å¿…é¡»ä½äºå †ä¸Š")]),s._v(" "),a("li",[a("code",[s._v("user-ptr")]),s._v("  ç±»å‹å…·ä½“ç”Ÿå‘½å‘¨æœŸç¼–è¯‘æ—¶ä¸å¯æ¨æ–­ï¼Œè¢«ç§»åŠ¨è¿› Elisp VM çš„å¤åˆæ•°æ®ç±»å‹\nå¿…é¡»æ»¡è¶³  "),a("code",[s._v("'static")]),s._v("  ç”Ÿå‘½å‘¨æœŸçº¦æŸ")]),s._v(" "),a("li",[s._v("ç”±äºæ— æ³•é‡æ–°è·å¾—æ‰€æœ‰æƒï¼ŒRust åªèƒ½ç”¨ä¸å¯å˜å¼•ç”¨è®¿é—®  "),a("code",[s._v("user-ptr")]),s._v("  ç±»å‹ï¼Œå¸¸å¸¸éœ€è¦ä½¿ç”¨\nå†…éƒ¨å¯å˜æ€§ï¼ˆå•çº¿ç¨‹  "),a("code",[s._v("RefCell")]),s._v(" ï¼Œå¤šçº¿ç¨‹é”æœºåˆ¶ï¼ŒåŸå­ç±»å‹ç­‰ï¼‰")])]),s._v(" "),a("p",[s._v("åœ¨éå¤š Rust çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œ "),a("code",[s._v("emacs-module-rs")]),s._v("  çš„  "),a("code",[s._v("#[defun]")]),s._v("  å®å¯ä»¥ç®€åŒ–å¤§éƒ¨ä»½æ ·æ¿ä»£\nç ã€‚")]),s._v(" "),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("std"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("collections"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("emacs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("defun"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[emacs::module(name = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rs-hash-map"')]),s._v(", separator = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v(")]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ‡è®°å‡½æ•°è¿”å›ä¸€ä¸ªç”¨ RefCell åŒ…è£¹çš„ user-ptr ç±»å‹")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// #[defun] å®ä¼šè‡ªåŠ¨å°†å…¶åŒ…è£¹æˆ Box<RefCell<Map>>")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[defun(user_ptr)]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("make")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ok")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åœ¨ #[defun] çš„å‚æ•°ä¸­ï¼Œå¼•ç”¨ç±»å‹æ€»è¡¨ç¤ºç”± #[defun(user-ptr)] åµŒå…¥çš„ user-ptr")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çš„å®ä¾‹çš„å¼•ç”¨")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[defun]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Option")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ok")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[defun]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mut")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Option")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ok")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("insert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ok")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("div",{staticClass:"language-lisp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-lisp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("rs-hash-map/make")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("rs-hash-map/get")]),s._v(" m "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; -> nil")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("rs-hash-map/set")]),s._v(" m "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; -> nil")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("rs-hash-map/get")]),s._v(" m "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('; -> "1"')]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("rs-hash-map/set")]),s._v(" m "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('; -> "1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("rs-hash-map/get")]),s._v(" m "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('; -> "2"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"é”™è¯¯å¤„ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é”™è¯¯å¤„ç†"}},[s._v("#")]),s._v(" é”™è¯¯å¤„ç†")]),s._v(" "),a("h3",{attrs:{id:"åœ¨rustä¸­å¤„ç†elispé”™è¯¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨rustä¸­å¤„ç†elispé”™è¯¯"}},[s._v("#")]),s._v(" åœ¨ Rust ä¸­å¤„ç† Elisp é”™è¯¯")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("è­¦å‘Š")]),s._v(" "),a("p",[a("strong",[s._v("å¼ºçƒˆä¸å»ºè®®åœ¨ Rust ä»£ç ä¸­å¤„ç† Elisp ä»£ç çš„é”™è¯¯ï¼")]),s._v(" åœ¨ Rust ä»£ç ä¸­å¤„ç†å¯èƒ½\nçš„ Elisp çš„é”™è¯¯ç¹çä¸”å®¹æ˜“é€ æˆå†…å­˜ä¸å®‰å…¨ï¼ˆæ¶‰åŠ unsafe ä»£ç ï¼‰ã€‚è¯·ç›´æ¥ä½¿ç”¨  "),a("code",[s._v("?")]),s._v("  æ“ä½œç¬¦å‘\nä¸ŠæŠ›å‡ºåœ¨ Rust ä»£ç ä¸­è°ƒç”¨ Elisp ä»£ç æ—¶å¯èƒ½çš„æŠ›é”™ã€‚è¿™äº›é”™è¯¯æœ€ç»ˆä¼šä»¥ "),a("code",[s._v("rust-error")]),s._v("  çš„é”™è¯¯\nç±»å‹æš´éœ²ç»™ Elisp VMã€‚")])]),s._v(" "),a("h3",{attrs:{id:"åœ¨elispä»£ç ä¸­å¤„ç†rusté”™è¯¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨elispä»£ç ä¸­å¤„ç†rusté”™è¯¯"}},[s._v("#")]),s._v(" åœ¨ Elisp ä»£ç ä¸­å¤„ç† Rust é”™è¯¯")]),s._v(" "),a("p",[a("code",[s._v("emacs-module-rs")]),s._v("  æš´éœ²äº†ä¸¤ç§é”™è¯¯ç±»å‹ä¾›ç”¨æˆ·åœ¨ Elisp ç«¯ç”¨ "),a("code",[s._v("condition-case")]),s._v("  å¤„ç†ã€‚")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("rust-error")]),s._v("  æ‰€æœ‰ç”± Rust åˆ¶é€ çš„é”™è¯¯ã€‚")]),s._v(" "),a("li",[a("code",[s._v("rust-wrong-type-user-ptr")]),s._v("  å½“å°è¯•æŠŠä¸€ä¸ª lisp å€¼è½¬æ¢ä¸ºä¸€ä¸ª user-ptr åœ¨ Rust é‡Œçš„å€¼æ—¶ï¼Œ\nè‹¥ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™æŠ›å‡ºè¯¥é”™è¯¯ã€‚è¯¥é”™è¯¯æ˜¯  "),a("code",[s._v("rust-error")]),s._v("  çš„å­ç±»å‹é”™è¯¯ã€‚")])]),s._v(" "),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœ value å†…å«æœ‰çš„ä¸æ˜¯ RefCell<HashMap<String, String>>ï¼Œæˆ–è€…ç”šè‡³ä¸æ˜¯ä¸€ä¸ª")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// user-ptrï¼ŒElisp ç«¯ä¼šæŠ›å‡ºä¸€ä¸ª rust-wrong-type-user-ptr é”™è¯¯ã€‚")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RefCell")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("into_rust")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("æç¤º")]),s._v(" "),a("p",[s._v("å¦‚æœä½ éœ€è¦åœ¨ Rust ä»£ç é‡ŒæŠ›å‡ºç±»å‹æ›´ç²¾ç¡®çš„ Elisp é”™è¯¯ï¼Œå¯ä»¥å°è¯•åœ¨ Rust é‡Œè°ƒç”¨ Elisp å‡½æ•°\n "),a("code",[s._v("signal")]),s._v("  ã€‚")]),s._v(" "),a("div",{staticClass:"language-rust line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-rust"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[emacs::module(name = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(")]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[defun]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("signal_wrong_type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mismatched type!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("to_owned")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signal"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wrong-type-argument"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("unreachable!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ok")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-lisp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-lisp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("condition-case")]),s._v(" e\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("test-signal-wrong-type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("wrong-type-argument")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token car"}},[s._v("error-message-string")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(';; => "Wrong type argument: \\"Mismatched type!\\""')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("h3",{attrs:{id:"åœ¨elispä¸­å¤„ç†rust-panic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨elispä¸­å¤„ç†rust-panic"}},[s._v("#")]),s._v(" åœ¨ Elisp ä¸­å¤„ç† Rust panic")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("è­¦å‘Š")]),s._v(" "),a("p",[s._v("è·¨è¶Š FFI è¾¹ç•Œçš„ unwind æ˜¯ä¸€ä¸ª "),a("strong",[s._v("æœªå®šä¹‰è¡Œä¸º")]),s._v("ã€‚ "),a("code",[s._v("emacs-module-rs")]),s._v("  ä¼šå°è¯•ç”¨\n "),a("code",[s._v("catch_unwind")]),s._v("  æ•æ‰ panicï¼Œé—æ†¾çš„æ˜¯è¿™å¹¶ä¸æ€»å¥æ•ˆï¼ï¼æœ‰çš„ panic æ ¹æœ¬ä¸ä½¿ç”¨ unwind å®ç°ï¼\n "),a("code",[s._v("catch_unwind")]),s._v("  å¯ä»¥æ•æ‰åˆ°çš„ panic ä¼šå˜æˆä¸€ä¸ª Elisp é”™è¯¯ï¼Œè€Œæ— æ³•æ•æ‰çš„é”™è¯¯å…¶è¡Œä¸ºåˆ™\nä¾èµ–äºå…·ä½“å®ç°ï¼ˆå¦‚è°ƒç”¨ abort å®ç° panic ä¼šæŠŠä½ çš„ Emacs è¿å¸¦å´©æ‰ ğŸ˜›ï¼‰")]),s._v(" "),a("p",[s._v("panic å¸¸ä»£è¡¨ä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œè¡¨æ˜ç¨‹åºçš„é€»è¾‘å‡ºäº†é—®é¢˜ã€‚å°½ç®¡æœ‰åŠæ³•åœ¨ Elisp ä¸­æ•æ‰ä¸€ä¸ª\n Rust panicï¼Œä½†æˆ‘ä¸ä¼šåœ¨è¿™é‡Œæ•™ä½ æ€ä¹ˆåšï¼ï¼æ¯”èµ·æ©ç›–é”™è¯¯çš„å‘ç”Ÿï¼Œæ›´åº”è¯¥æ‰¾å‡ºé”™è¯¯çš„åŸ\nå› ã€‚")])]),s._v(" "),a("h3",{attrs:{id:"rusté”™è¯¯ä¹‹é—´çš„äº’ç›¸å¤„ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rusté”™è¯¯ä¹‹é—´çš„äº’ç›¸å¤„ç†"}},[s._v("#")]),s._v(" Rust é”™è¯¯ä¹‹é—´çš„äº’ç›¸å¤„ç†")]),s._v(" "),a("p",[a("code",[s._v("emacs-module-rs")]),s._v("  æœ¬èº«ä½¿ç”¨\n"),a("a",{attrs:{href:"https://github.com/rust-lang-nursery/failure",target:"_blank",rel:"noopener noreferrer"}},[s._v(" failure"),a("OutboundLink")],1),s._v(" åº“å¤„ç†é”™è¯¯ã€‚å¦‚æœä½ æ°å¥½\nä¹Ÿä½¿ç”¨äº† failure å¤„ç†é”™è¯¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨  "),a("code",[s._v("?")]),s._v("  æ“ä½œç¬¦æŠ›å‡ºä½ çš„é”™è¯¯ï¼Œ\n "),a("code",[s._v("emacs-module-rs")]),s._v("  ä¼šå°†å…¶ç»Ÿä¸€å¤„ç†ä¸º  "),a("code",[s._v("rust-error")]),s._v("  ç±»å‹çš„ Elisp é”™è¯¯æŠ›å‡ºç»™ Elisp VMã€‚")]),s._v(" "),a("p",[s._v("å…¶ä»–ç±»å‹çš„é”™è¯¯ï¼Œåœ¨è½¬æ¢ä¸º  "),a("code",[s._v("failure::Error")]),s._v("  åä¹Ÿå¯ä»¥æŒ‰åŒæ ·çš„æ–¹å¼æŠ›å‡ºç»™ Elisp VMã€‚")]),s._v(" "),a("h2",{attrs:{id:"å»¶ä¼¸é˜…è¯»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å»¶ä¼¸é˜…è¯»"}},[s._v("#")]),s._v(" å»¶ä¼¸é˜…è¯»")]),s._v(" "),a("p",[s._v("æœ¬æ–‡å¯¹ç¼–ç¨‹åŠ¨æ€æ¨¡å—ä¸­ä¸å¸¸è§çš„ç»†èŠ‚åšäº†éƒ¨åˆ†çœç•¥ä»¥ä¿è¯ä½œä¸ºå…¥é—¨è¯»ç‰©çš„å¯è¯»æ€§ï¼Œè¦å®Œæ•´çš„\nç†è§£ "),a("code",[s._v("emacs-module-rs")]),s._v("  ï¼Œè¯·ç§»æ­¥"),a("a",{attrs:{href:"https://ubolonton.github.io/emacs-module-rs/latest/",target:"_blank",rel:"noopener noreferrer"}},[s._v(" emacs-module-rs's user guideï¼ˆè‹±\næ–‡ï¼‰"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("è¦æ›´æ·±å…¥ç†è§£ Rust è¯­è¨€ä»¥åŠ  "),a("code",[s._v("emacs-module-rs")]),s._v("  èƒŒåçš„é­”æ³•ï¼Œé˜…è¯» Rust å®˜ç½‘æä¾›çš„æ•™ç¨‹æ˜¯\nä¸é”™çš„é€‰æ‹©ã€‚")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://doc.rust-lang.org/book/",target:"_blank",rel:"noopener noreferrer"}},[s._v("The Rust Programming Languageï¼ˆè‹±æ–‡ï¼‰"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://doc.rust-lang.org/nomicon",target:"_blank",rel:"noopener noreferrer"}},[s._v("Rust Nomiconï¼ˆè‹±æ–‡ï¼‰"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("ä¸‹åˆ—æ˜¯ä¸€äº›ç”¨ Rust æ„å»ºåŠ¨æ€æ¨¡å—çš„ Emacs æ’ä»¶åˆ—è¡¨ï¼Œä¹Ÿè®¸å¯ä»¥åœ¨ä½ å†™æ–°æ¨¡å—çš„æ—¶å€™\nå¸®åŠ©åˆ°ä½ ã€‚")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/rustify-emacs/fuz.el",target:"_blank",rel:"noopener noreferrer"}},[s._v("fuz.el"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/ubolonton/emacs-tree-sitter",target:"_blank",rel:"noopener noreferrer"}},[s._v("emacs-tree-sitter"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);